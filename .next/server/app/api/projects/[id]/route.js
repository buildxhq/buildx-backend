(()=>{var e={};e.id=514,e.ids=[514],e.modules={193:(e,r,t)=>{"use strict";t.d(r,{M:()=>n});var s=t(6010);async function n(e,r,t,n){try{await s.db.activityLog.create({data:{userId:e,action:r,entity:t||"",entityId:n||""}})}catch(e){console.error("[LOG_ACTIVITY_ERROR]",e)}}},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1098:(e,r,t)=>{"use strict";t.d(r,{nr:()=>a});var s=t(3205),n=t.n(s);function a(e){try{return n().verify(e,process.env.JWT_SECRET)}catch{return null}}t(6010)},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{"use strict";e.exports=require("crypto")},6010:(e,r,t)=>{"use strict";t.d(r,{db:()=>n});let s=require("@prisma/client"),n=globalThis.prisma??new s.PrismaClient},6487:()=>{},7654:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>R,serverHooks:()=>w,workAsyncStorage:()=>j,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{DELETE:()=>x,GET:()=>c,PUT:()=>l});var n=t(6559),a=t(8088),i=t(7719),o=t(6010),u=t(1098),d=t(193),p=t(2190);async function c(e,r){let t=r.params?.id;try{let r=e.headers.get("authorization")?.replace("Bearer ",""),s=await (0,u.nr)(r),n=await o.db.user.findUnique({where:{id:String(s.id)}});if(!n)return p.NextResponse.json({error:"User not found"},{status:404});let a=await o.db.project.findUnique({where:{id:t},include:{files:!0,invites:!0,company:!0}});if(!a||a.companyId!==n.companyId&&"admin"!==n.role)return p.NextResponse.json({error:"Unauthorized or not found"},{status:403});return p.NextResponse.json(a)}catch(e){return console.error("[PROJECT_GET_ERROR]",e),p.NextResponse.json({error:"Something went wrong"},{status:500})}}async function l(e,r){let t=r?.params?.id;try{let r=e.headers.get("authorization")?.replace("Bearer ",""),s=await (0,u.nr)(r),n=await o.db.user.findUnique({where:{id:String(s.id)}});if(!n)return p.NextResponse.json({error:"User not found"},{status:404});let a=await o.db.project.findUnique({where:{id:t}});if(!a||a.companyId!==n.companyId)return p.NextResponse.json({error:"Unauthorized"},{status:403});let i=await e.json(),c=await o.db.project.update({where:{id:t},data:{name:i.name,address:i.address,dueDate:i.dueDate?new Date(i.dueDate):void 0,visibility:i.visibility,scopeSummary:i.scopeSummary}});return await (0,d.M)(n.id.toString(),"PROJECT_UPDATED","Project",t),p.NextResponse.json(c)}catch(e){return console.error("[PROJECT_UPDATE_ERROR]",e),p.NextResponse.json({error:"Failed to update project"},{status:500})}}async function x(e,r){let t=r?.params?.id;try{let r=e.headers.get("authorization")?.replace("Bearer ",""),s=await (0,u.nr)(r),n=await o.db.user.findUnique({where:{id:String(s.id)}});if(!n)return p.NextResponse.json({error:"User not found"},{status:404});if("admin"!==n.role)return p.NextResponse.json({error:"Only admins can delete projects"},{status:403});return await o.db.project.delete({where:{id:t}}),await (0,d.M)(n.id.toString(),"PROJECT_DELETED","Project",t),p.NextResponse.json({message:"Project deleted"})}catch(e){return console.error("[PROJECT_DELETE_ERROR]",e),p.NextResponse.json({error:"Failed to delete project"},{status:500})}}let R=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/projects/[id]/route",pathname:"/api/projects/[id]",filename:"route",bundlePath:"app/api/projects/[id]/route"},resolvedPagePath:"C:\\Users\\aande\\buildx-backend\\app\\api\\projects\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:j,workUnitAsyncStorage:m,serverHooks:w}=R;function f(){return(0,i.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:m})}},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},8354:e=>{"use strict";e.exports=require("util")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,580,205],()=>t(7654));module.exports=s})();